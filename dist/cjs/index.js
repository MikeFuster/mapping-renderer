var SessionDataMapper=function(t){"use strict";function e(t,e){var r,i;if("function"==typeof e)void 0!==(i=e(t))&&(t=i);else if(Array.isArray(e))for(r=0;r<e.length;r++)void 0!==(i=e[r](t))&&(t=i);return t}function r(t,e){return"-"===t[0]&&Array.isArray(e)&&/^-\d+$/.test(t)?e.length+parseInt(t,10):t}function i(t){return"[object Object]"===Object.prototype.toString.call(t)}function n(t){return Object(t)===t}function o(t){return 0===Object.keys(t).length}var s=["__proto__","prototype","constructor"],a=function(t){return-1===s.indexOf(t)};function c(t,e){t.indexOf("[")>=0&&(t=t.replace(/\[/g,e).replace(/]/g,""));var r=t.split(e);if(r.filter(a).length!==r.length)throw Error("Refusing to update blacklisted property "+t);return r}var p=Object.prototype.hasOwnProperty;function u(t,e,r,i){if(!(this instanceof u))return new u(t,e,r,i);void 0===e&&(e=!1),void 0===r&&(r=!0),void 0===i&&(i=!0),this.separator=t||".",this.override=e,this.useArray=r,this.useBrackets=i,this.keepArray=!1,this.cleanup=[]}var f=new u(".",!1,!0,!0);function l(t){return function(){return f[t].apply(f,arguments)}}u.prototype._fill=function(t,r,i,s){var a=t.shift();if(t.length>0){if(r[a]=r[a]||(this.useArray&&function(t){return/^\d+$/.test(t)}(t[0])?[]:{}),!n(r[a])){if(!this.override){if(!n(i)||!o(i))throw new Error("Trying to redefine `"+a+"` which is a "+typeof r[a]);return}r[a]={}}this._fill(t,r[a],i,s)}else{if(!this.override&&n(r[a])&&!o(r[a])){if(!n(i)||!o(i))throw new Error("Trying to redefine non-empty obj['"+a+"']");return}r[a]=e(i,s)}},u.prototype.object=function(t,r){var i=this;return Object.keys(t).forEach((function(n){var o=void 0===r?null:r[n],s=c(n,i.separator).join(i.separator);-1!==s.indexOf(i.separator)?(i._fill(s.split(i.separator),t,t[n],o),delete t[n]):t[n]=e(t[n],o)})),t},u.prototype.str=function(t,r,i,n){var o=c(t,this.separator).join(this.separator);return-1!==t.indexOf(this.separator)?this._fill(o.split(this.separator),i,r,n):i[t]=e(r,n),i},u.prototype.pick=function(t,e,i,n){var o,s,a,p,u;for(s=c(t,this.separator),o=0;o<s.length;o++){if(p=r(s[o],e),!e||"object"!=typeof e||!(p in e))return;if(o===s.length-1)return i?(a=e[p],n&&Array.isArray(e)?e.splice(p,1):delete e[p],Array.isArray(e)&&(u=s.slice(0,-1).join("."),-1===this.cleanup.indexOf(u)&&this.cleanup.push(u)),a):e[p];e=e[p]}return i&&Array.isArray(e)&&(e=e.filter((function(t){return void 0!==t}))),e},u.prototype.delete=function(t,e){return this.remove(t,e,!0)},u.prototype.remove=function(t,e,r){var i;if(this.cleanup=[],Array.isArray(t)){for(i=0;i<t.length;i++)this.pick(t[i],e,!0,r);return r||this._cleanup(e),e}return this.pick(t,e,!0,r)},u.prototype._cleanup=function(t){var e,r,i,n;if(this.cleanup.length){for(r=0;r<this.cleanup.length;r++)e=(e=(n=(i=this.cleanup[r].split(".")).splice(0,-1).join("."))?this.pick(n,t):t)[i[0]].filter((function(t){return void 0!==t})),this.set(this.cleanup[r],e,t);this.cleanup=[]}},u.prototype.del=u.prototype.remove,u.prototype.move=function(t,r,i,n,o){return"function"==typeof n||Array.isArray(n)?this.set(r,e(this.pick(t,i,!0),n),i,o):(o=n,this.set(r,this.pick(t,i,!0),i,o)),i},u.prototype.transfer=function(t,r,i,n,o,s){return"function"==typeof o||Array.isArray(o)?this.set(r,e(this.pick(t,i,!0),o),n,s):(s=o,this.set(r,this.pick(t,i,!0),n,s)),n},u.prototype.copy=function(t,r,i,n,o,s){return"function"==typeof o||Array.isArray(o)?this.set(r,e(JSON.parse(JSON.stringify(this.pick(t,i,!1))),o),n,s):(s=o,this.set(r,this.pick(t,i,!1),n,s)),n},u.prototype.set=function(t,e,r,n){var o,s,a,u;if(void 0===e)return r;for(a=c(t,this.separator),o=0;o<a.length;o++){if(u=a[o],o===a.length-1)if(n&&i(e)&&i(r[u]))for(s in e)p.call(e,s)&&(r[u][s]=e[s]);else if(n&&Array.isArray(r[u])&&Array.isArray(e))for(var f=0;f<e.length;f++)r[a[o]].push(e[f]);else r[u]=e;else p.call(r,u)&&(i(r[u])||Array.isArray(r[u]))||(/^\d+$/.test(a[o+1])?r[u]=[]:r[u]={});r=r[u]}return r},u.prototype.transform=function(t,e,r){return e=e||{},r=r||{},Object.keys(t).forEach(function(i){this.set(t[i],this.pick(i,e),r)}.bind(this)),r},u.prototype.dot=function(t,e,r){e=e||{},r=r||[];var s=Array.isArray(t);return Object.keys(t).forEach(function(a){var c=s&&this.useBrackets?"["+a+"]":a;if(n(t[a])&&(i(t[a])&&!o(t[a])||Array.isArray(t[a])&&!this.keepArray&&0!==t[a].length)){if(s&&this.useBrackets){var p=r[r.length-1]||"";return this.dot(t[a],e,r.slice(0,-1).concat(p+c))}return this.dot(t[a],e,r.concat(c))}s&&this.useBrackets?e[r.join(this.separator).concat("["+a+"]")]=t[a]:e[r.concat(c).join(this.separator)]=t[a]}.bind(this)),e},u.pick=l("pick"),u.move=l("move"),u.transfer=l("transfer"),u.transform=l("transform"),u.copy=l("copy"),u.object=l("object"),u.str=l("str"),u.set=l("set"),u.delete=l("delete"),u.del=u.remove=l("remove"),u.dot=l("dot"),["override","overwrite"].forEach((function(t){Object.defineProperty(u,t,{get:function(){return f.override},set:function(t){f.override=!!t}})})),["useArray","keepArray","useBrackets"].forEach((function(t){Object.defineProperty(u,t,{get:function(){return f[t]},set:function(e){f[t]=e}})})),u._process=e;var y=u;const h=t=>{const e=[];return Object.keys(y.dot(t.properties)).forEach((r=>{const i=(t=>{const e=t.replaceAll("properties.","").split(".");return e.slice(0,e.length-1).join(".")})(r),n=r.split("."),o=n.slice(0,n.length-1).join("."),s=y.pick(o,t.properties),a={value:i,...s};e.find((t=>t.value===i))||e.push(a)})),e},d=(t,e)=>{let r=null;return Object.keys(y.dot(t)).forEach((i=>{if(i.includes("type")&&y.pick(i,t)===e){const e=i.replace("type","scope"),n=y.pick(e,t).split("/"),o=n[n.length-1];r=o}})),r},v=t=>{if(t.baseKeys.dynamicObjectKey)return t[t.baseKeys.dynamicObjectKey].reduce(((t,{source:e,target:r})=>r?.value?(t[e.value]=r.value,t):t),{})};var b=Object.freeze({__proto__:null,createSchema:({source:t,target:e,uischema:r,dataToTransform:i})=>{const n=d(r,"Dynamic"),o=d(r,"SourceTable"),s=d(r,"TransformedTable"),a=h(t),c=h(e);return{schema:{type:"object",properties:{[n]:{type:"array",items:{type:"object",required:["target"],properties:{source:{type:"object",title:t?.title,enum:a},target:{type:"object",title:e?.title,enum:c}}}},...o&&{[o]:{type:"object"}},...s&&{[s]:{type:"object"}}}},data:{[n]:a.map((t=>({source:t}))),[o]:i,[s]:i,baseKeys:{dynamicObjectKey:n}}}},createRecipe:v,transformData:(t,e)=>{const r=v(t);return y.transform(y.dot(r),e)}});return t.sessionDataMapper=b,Object.defineProperty(t,"__esModule",{value:!0}),t}({});
