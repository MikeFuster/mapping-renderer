import e,{useState as t,useMemo as r}from"react";import{withJsonFormsControlProps as n}from"@jsonforms/react";import{rankWith as i,and as o,uiTypeIs as a}from"@jsonforms/core";import{TextField as s,FormControl as c,InputLabel as l,Select as p,MenuItem as u,TableContainer as f,Paper as h,Table as y,TableHead as m,TableRow as d,TableCell as v,TableBody as g}from"@material-ui/core";const k=({source:r,targetEnum:n,onChange:i})=>{const[o,a]=t("");return e.createElement("div",{style:{display:"flex",marginBottom:"20px"}},e.createElement(s,{label:r?.label||r.value,variant:"outlined","aria-readonly":"true",disabled:!0,style:{marginRight:"40px",width:"100%"}}),e.createElement(c,{variant:"outlined",style:{width:"100%"}},e.createElement(l,null,"Select a Property"),e.createElement(p,{label:"Select a Property",value:o,onChange:e=>{a(e.target.value);const t=n.find((t=>t.value===e.target.value));t&&i(r.value,t)}},n.map((t=>e.createElement(u,{key:t.value,value:t.value},t?.label||t.value))))))};function E(e,t){var r,n;if("function"==typeof t)void 0!==(n=t(e))&&(e=n);else if(Array.isArray(t))for(r=0;r<t.length;r++)void 0!==(n=t[r](e))&&(e=n);return e}function A(e,t){return"-"===e[0]&&Array.isArray(t)&&/^-\d+$/.test(e)?t.length+parseInt(e,10):e}function b(e){return"[object Object]"===Object.prototype.toString.call(e)}function j(e){return Object(e)===e}function O(e){return 0===Object.keys(e).length}var w=["__proto__","prototype","constructor"],x=function(e){return-1===w.indexOf(e)};function T(e,t){e.indexOf("[")>=0&&(e=e.replace(/\[/g,t).replace(/]/g,""));var r=e.split(t);if(r.filter(x).length!==r.length)throw Error("Refusing to update blacklisted property "+e);return r}var _=Object.prototype.hasOwnProperty;function B(e,t,r,n){if(!(this instanceof B))return new B(e,t,r,n);void 0===t&&(t=!1),void 0===r&&(r=!0),void 0===n&&(n=!0),this.separator=e||".",this.override=t,this.useArray=r,this.useBrackets=n,this.keepArray=!1,this.cleanup=[]}var S=new B(".",!1,!0,!0);function P(e){return function(){return S[e].apply(S,arguments)}}B.prototype._fill=function(e,t,r,n){var i=e.shift();if(e.length>0){if(t[i]=t[i]||(this.useArray&&function(e){return/^\d+$/.test(e)}(e[0])?[]:{}),!j(t[i])){if(!this.override){if(!j(r)||!O(r))throw new Error("Trying to redefine `"+i+"` which is a "+typeof t[i]);return}t[i]={}}this._fill(e,t[i],r,n)}else{if(!this.override&&j(t[i])&&!O(t[i])){if(!j(r)||!O(r))throw new Error("Trying to redefine non-empty obj['"+i+"']");return}t[i]=E(r,n)}},B.prototype.object=function(e,t){var r=this;return Object.keys(e).forEach((function(n){var i=void 0===t?null:t[n],o=T(n,r.separator).join(r.separator);-1!==o.indexOf(r.separator)?(r._fill(o.split(r.separator),e,e[n],i),delete e[n]):e[n]=E(e[n],i)})),e},B.prototype.str=function(e,t,r,n){var i=T(e,this.separator).join(this.separator);return-1!==e.indexOf(this.separator)?this._fill(i.split(this.separator),r,t,n):r[e]=E(t,n),r},B.prototype.pick=function(e,t,r,n){var i,o,a,s,c;for(o=T(e,this.separator),i=0;i<o.length;i++){if(s=A(o[i],t),!t||"object"!=typeof t||!(s in t))return;if(i===o.length-1)return r?(a=t[s],n&&Array.isArray(t)?t.splice(s,1):delete t[s],Array.isArray(t)&&(c=o.slice(0,-1).join("."),-1===this.cleanup.indexOf(c)&&this.cleanup.push(c)),a):t[s];t=t[s]}return r&&Array.isArray(t)&&(t=t.filter((function(e){return void 0!==e}))),t},B.prototype.delete=function(e,t){return this.remove(e,t,!0)},B.prototype.remove=function(e,t,r){var n;if(this.cleanup=[],Array.isArray(e)){for(n=0;n<e.length;n++)this.pick(e[n],t,!0,r);return r||this._cleanup(t),t}return this.pick(e,t,!0,r)},B.prototype._cleanup=function(e){var t,r,n,i;if(this.cleanup.length){for(r=0;r<this.cleanup.length;r++)t=(t=(i=(n=this.cleanup[r].split(".")).splice(0,-1).join("."))?this.pick(i,e):e)[n[0]].filter((function(e){return void 0!==e})),this.set(this.cleanup[r],t,e);this.cleanup=[]}},B.prototype.del=B.prototype.remove,B.prototype.move=function(e,t,r,n,i){return"function"==typeof n||Array.isArray(n)?this.set(t,E(this.pick(e,r,!0),n),r,i):(i=n,this.set(t,this.pick(e,r,!0),r,i)),r},B.prototype.transfer=function(e,t,r,n,i,o){return"function"==typeof i||Array.isArray(i)?this.set(t,E(this.pick(e,r,!0),i),n,o):(o=i,this.set(t,this.pick(e,r,!0),n,o)),n},B.prototype.copy=function(e,t,r,n,i,o){return"function"==typeof i||Array.isArray(i)?this.set(t,E(JSON.parse(JSON.stringify(this.pick(e,r,!1))),i),n,o):(o=i,this.set(t,this.pick(e,r,!1),n,o)),n},B.prototype.set=function(e,t,r,n){var i,o,a,s;if(void 0===t)return r;for(a=T(e,this.separator),i=0;i<a.length;i++){if(s=a[i],i===a.length-1)if(n&&b(t)&&b(r[s]))for(o in t)_.call(t,o)&&(r[s][o]=t[o]);else if(n&&Array.isArray(r[s])&&Array.isArray(t))for(var c=0;c<t.length;c++)r[a[i]].push(t[c]);else r[s]=t;else _.call(r,s)&&(b(r[s])||Array.isArray(r[s]))||(/^\d+$/.test(a[i+1])?r[s]=[]:r[s]={});r=r[s]}return r},B.prototype.transform=function(e,t,r){return t=t||{},r=r||{},Object.keys(e).forEach(function(n){this.set(e[n],this.pick(n,t),r)}.bind(this)),r},B.prototype.dot=function(e,t,r){t=t||{},r=r||[];var n=Array.isArray(e);return Object.keys(e).forEach(function(i){var o=n&&this.useBrackets?"["+i+"]":i;if(j(e[i])&&(b(e[i])&&!O(e[i])||Array.isArray(e[i])&&!this.keepArray&&0!==e[i].length)){if(n&&this.useBrackets){var a=r[r.length-1]||"";return this.dot(e[i],t,r.slice(0,-1).concat(a+o))}return this.dot(e[i],t,r.concat(o))}n&&this.useBrackets?t[r.join(this.separator).concat("["+i+"]")]=e[i]:t[r.concat(o).join(this.separator)]=e[i]}.bind(this)),t},B.pick=P("pick"),B.move=P("move"),B.transfer=P("transfer"),B.transform=P("transform"),B.copy=P("copy"),B.object=P("object"),B.str=P("str"),B.set=P("set"),B.delete=P("delete"),B.del=B.remove=P("remove"),B.dot=P("dot"),["override","overwrite"].forEach((function(e){Object.defineProperty(B,e,{get:function(){return S.override},set:function(e){S.override=!!e}})})),["useArray","keepArray","useBrackets"].forEach((function(e){Object.defineProperty(B,e,{get:function(){return S[e]},set:function(t){S[e]=t}})})),B._process=E;var C=B;const J=i(3,o(a("Dynamic"))),N=n((({data:n,handleChange:i,path:o,...a})=>{const[s,c]=t({}),l=a.schema,p=a.rootSchema,u=(e,t)=>{const r=n.findIndex((t=>t.source.value===e));n[r]={...n[r],target:t},i(o,n);const a=(e=>e.keys.reduce(((e,{source:t,target:r})=>(e[t.value]=r.value,e)),{}))({keys:n});c(a)},E=r((()=>C.dot(p.properties.dataToTransform)),[p]),A=r((()=>C.transform(C.dot(s),p.properties.dataToTransform)),[s,p]);return e.createElement("div",{style:{width:"1100px",margin:"0 auto"}},e.createElement("h2",{style:{width:"max-content"}},"Base Table"),e.createElement(f,{component:h},e.createElement(y,null,e.createElement(m,null,e.createElement(d,null,Object.keys(E).map((t=>e.createElement(v,{style:{fontWeight:600},key:t},t))))),e.createElement(g,null,e.createElement(d,null,Object.keys(E).map((t=>e.createElement(v,{key:t},C.pick(t,p.properties.dataToTransform)))))))),Object.keys(A).length>0&&e.createElement(e.Fragment,null,e.createElement("h2",{style:{width:"max-content"}},"Transformed Table"),e.createElement(f,{component:h},e.createElement(y,null,e.createElement(m,null,e.createElement(d,null,Object.keys(C.dot(A)).map((t=>e.createElement(v,{style:{fontWeight:600},key:t},t))))),e.createElement(g,null,e.createElement(d,null,Object.keys(A).map((t=>e.createElement(v,{key:t},JSON.stringify(C.pick(t,A)))))))))),e.createElement("div",{style:{display:"flex"}},e.createElement("h2",{style:{marginRight:"auto"}},l.items.properties.source.title),e.createElement("h2",null,l.items.properties.target.title)),l.items.properties.source.enum.map((t=>e.createElement(k,{key:t.value,source:t,targetEnum:l.items.properties.target.enum,onChange:u}))))})),R={tester:J,renderer:N};export{R as MappingRendererControl,N as MappingRendererControlRenderer,J as MappingRendererControlTester};
