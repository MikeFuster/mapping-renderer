import e,{useState as t,useMemo as r}from"react";import{withJsonFormsControlProps as n,useJsonForms as i}from"@jsonforms/react";import{rankWith as a,and as o,uiTypeIs as s}from"@jsonforms/core";import{TextField as c,FormControl as l,InputLabel as u,Select as p,MenuItem as f,TableContainer as h,Paper as y,Table as m,TableHead as d,TableRow as v,TableCell as g,TableBody as E}from"@material-ui/core";const k=({source:r,targetEnum:n,onChange:i})=>{const[a,o]=t("");return e.createElement("div",{style:{display:"flex",marginBottom:"20px"}},e.createElement(c,{label:r?.label||r.value,variant:"outlined","aria-readonly":"true",disabled:!0,style:{marginRight:"40px",width:"100%"}}),e.createElement(l,{variant:"outlined",style:{width:"100%"}},e.createElement(u,null,"Select a Property"),e.createElement(p,{label:"Select a Property",value:a,onChange:e=>{o(e.target.value);const t=n.find((t=>t.value===e.target.value));t&&i(r.value,t)}},n.map((t=>e.createElement(f,{key:t.value,value:t.value},t?.label||t.value))))))},b={tester:a(3,o(s("Dynamic"))),renderer:n((({data:t,handleChange:r,path:n,...i})=>{const a=i.schema,o=(e,i)=>{const a=t.findIndex((t=>t.source.value===e));t[a]={...t[a],target:i},r(n,t)};return e.createElement("div",{style:{width:"1100px",margin:"0 auto"}},e.createElement("div",{style:{display:"flex"}},e.createElement("h2",{style:{marginRight:"auto"}},a.items.properties.source.title),e.createElement("h2",null,a.items.properties.target.title)),a.items.properties.source.enum.map((t=>e.createElement(k,{key:t.value,source:t,targetEnum:a.items.properties.target.enum,onChange:o}))))}))};function A(e,t){var r,n;if("function"==typeof t)void 0!==(n=t(e))&&(e=n);else if(Array.isArray(t))for(r=0;r<t.length;r++)void 0!==(n=t[r](e))&&(e=n);return e}function j(e,t){return"-"===e[0]&&Array.isArray(t)&&/^-\d+$/.test(e)?t.length+parseInt(e,10):e}function O(e){return"[object Object]"===Object.prototype.toString.call(e)}function w(e){return Object(e)===e}function x(e){return 0===Object.keys(e).length}var _=["__proto__","prototype","constructor"],S=function(e){return-1===_.indexOf(e)};function B(e,t){e.indexOf("[")>=0&&(e=e.replace(/\[/g,t).replace(/]/g,""));var r=e.split(t);if(r.filter(S).length!==r.length)throw Error("Refusing to update blacklisted property "+e);return r}var T=Object.prototype.hasOwnProperty;function P(e,t,r,n){if(!(this instanceof P))return new P(e,t,r,n);void 0===t&&(t=!1),void 0===r&&(r=!0),void 0===n&&(n=!0),this.separator=e||".",this.override=t,this.useArray=r,this.useBrackets=n,this.keepArray=!1,this.cleanup=[]}var C=new P(".",!1,!0,!0);function K(e){return function(){return C[e].apply(C,arguments)}}P.prototype._fill=function(e,t,r,n){var i=e.shift();if(e.length>0){if(t[i]=t[i]||(this.useArray&&function(e){return/^\d+$/.test(e)}(e[0])?[]:{}),!w(t[i])){if(!this.override){if(!w(r)||!x(r))throw new Error("Trying to redefine `"+i+"` which is a "+typeof t[i]);return}t[i]={}}this._fill(e,t[i],r,n)}else{if(!this.override&&w(t[i])&&!x(t[i])){if(!w(r)||!x(r))throw new Error("Trying to redefine non-empty obj['"+i+"']");return}t[i]=A(r,n)}},P.prototype.object=function(e,t){var r=this;return Object.keys(e).forEach((function(n){var i=void 0===t?null:t[n],a=B(n,r.separator).join(r.separator);-1!==a.indexOf(r.separator)?(r._fill(a.split(r.separator),e,e[n],i),delete e[n]):e[n]=A(e[n],i)})),e},P.prototype.str=function(e,t,r,n){var i=B(e,this.separator).join(this.separator);return-1!==e.indexOf(this.separator)?this._fill(i.split(this.separator),r,t,n):r[e]=A(t,n),r},P.prototype.pick=function(e,t,r,n){var i,a,o,s,c;for(a=B(e,this.separator),i=0;i<a.length;i++){if(s=j(a[i],t),!t||"object"!=typeof t||!(s in t))return;if(i===a.length-1)return r?(o=t[s],n&&Array.isArray(t)?t.splice(s,1):delete t[s],Array.isArray(t)&&(c=a.slice(0,-1).join("."),-1===this.cleanup.indexOf(c)&&this.cleanup.push(c)),o):t[s];t=t[s]}return r&&Array.isArray(t)&&(t=t.filter((function(e){return void 0!==e}))),t},P.prototype.delete=function(e,t){return this.remove(e,t,!0)},P.prototype.remove=function(e,t,r){var n;if(this.cleanup=[],Array.isArray(e)){for(n=0;n<e.length;n++)this.pick(e[n],t,!0,r);return r||this._cleanup(t),t}return this.pick(e,t,!0,r)},P.prototype._cleanup=function(e){var t,r,n,i;if(this.cleanup.length){for(r=0;r<this.cleanup.length;r++)t=(t=(i=(n=this.cleanup[r].split(".")).splice(0,-1).join("."))?this.pick(i,e):e)[n[0]].filter((function(e){return void 0!==e})),this.set(this.cleanup[r],t,e);this.cleanup=[]}},P.prototype.del=P.prototype.remove,P.prototype.move=function(e,t,r,n,i){return"function"==typeof n||Array.isArray(n)?this.set(t,A(this.pick(e,r,!0),n),r,i):(i=n,this.set(t,this.pick(e,r,!0),r,i)),r},P.prototype.transfer=function(e,t,r,n,i,a){return"function"==typeof i||Array.isArray(i)?this.set(t,A(this.pick(e,r,!0),i),n,a):(a=i,this.set(t,this.pick(e,r,!0),n,a)),n},P.prototype.copy=function(e,t,r,n,i,a){return"function"==typeof i||Array.isArray(i)?this.set(t,A(JSON.parse(JSON.stringify(this.pick(e,r,!1))),i),n,a):(a=i,this.set(t,this.pick(e,r,!1),n,a)),n},P.prototype.set=function(e,t,r,n){var i,a,o,s;if(void 0===t)return r;for(o=B(e,this.separator),i=0;i<o.length;i++){if(s=o[i],i===o.length-1)if(n&&O(t)&&O(r[s]))for(a in t)T.call(t,a)&&(r[s][a]=t[a]);else if(n&&Array.isArray(r[s])&&Array.isArray(t))for(var c=0;c<t.length;c++)r[o[i]].push(t[c]);else r[s]=t;else T.call(r,s)&&(O(r[s])||Array.isArray(r[s]))||(/^\d+$/.test(o[i+1])?r[s]=[]:r[s]={});r=r[s]}return r},P.prototype.transform=function(e,t,r){return t=t||{},r=r||{},Object.keys(e).forEach(function(n){this.set(e[n],this.pick(n,t),r)}.bind(this)),r},P.prototype.dot=function(e,t,r){t=t||{},r=r||[];var n=Array.isArray(e);return Object.keys(e).forEach(function(i){var a=n&&this.useBrackets?"["+i+"]":i;if(w(e[i])&&(O(e[i])&&!x(e[i])||Array.isArray(e[i])&&!this.keepArray&&0!==e[i].length)){if(n&&this.useBrackets){var o=r[r.length-1]||"";return this.dot(e[i],t,r.slice(0,-1).concat(o+a))}return this.dot(e[i],t,r.concat(a))}n&&this.useBrackets?t[r.join(this.separator).concat("["+i+"]")]=e[i]:t[r.concat(a).join(this.separator)]=e[i]}.bind(this)),t},P.pick=K("pick"),P.move=K("move"),P.transfer=K("transfer"),P.transform=K("transform"),P.copy=K("copy"),P.object=K("object"),P.str=K("str"),P.set=K("set"),P.delete=K("delete"),P.del=P.remove=K("remove"),P.dot=K("dot"),["override","overwrite"].forEach((function(e){Object.defineProperty(P,e,{get:function(){return C.override},set:function(e){C.override=!!e}})})),["useArray","keepArray","useBrackets"].forEach((function(e){Object.defineProperty(P,e,{get:function(){return C[e]},set:function(t){C[e]=t}})})),P._process=A;var D=P;const J={tester:a(3,o(s("SourceTable"))),renderer:n((({data:t})=>{const n=r((()=>D.dot(t)),[t]);return e.createElement("div",{style:{width:"1100px",margin:"0 auto"}},e.createElement("h2",{style:{width:"max-content"}},"Source Data"),e.createElement(h,{component:y},e.createElement(m,null,e.createElement(d,null,e.createElement(v,null,Object.keys(n).map((t=>e.createElement(g,{style:{fontWeight:600},key:t},t))))),e.createElement(E,null,e.createElement(v,null,Object.keys(n).map((r=>e.createElement(g,{key:r},D.pick(r,t)))))))))}))},N={tester:a(3,o(s("TransformedTable"))),renderer:n((({data:t})=>{const n=i(),a=r((()=>((e,t)=>{const r=(e=>{if(e.baseKeys.dynamicObjectKey)return e[e.baseKeys.dynamicObjectKey].reduce(((e,{source:t,target:r})=>r?.value?(e[t.value]=r.value,e):e),{})})(e);return D.transform(D.dot(r),t)})(n.core.data,t)||[]),[n.core.data,t]);return e.createElement("div",{style:{width:"1100px",margin:"0 auto"}},Object.keys(a||[]).length>0&&e.createElement(e.Fragment,null,e.createElement("h2",{style:{width:"max-content"}},"Transformed Data"),e.createElement(h,{component:y},e.createElement(m,null,e.createElement(d,null,e.createElement(v,null,Object.keys(D.dot(a)).map((t=>e.createElement(g,{style:{fontWeight:600},key:t},t))))),e.createElement(E,null,e.createElement(v,null,Object.keys(D.dot(a)).map((t=>e.createElement(g,{key:t},JSON.stringify(D.pick(t,a)))))))))))}))};export{b as MappingRendererControl,J as SourceTableControl,N as TransformedTableControl};
